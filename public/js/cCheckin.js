function Checkin(){this.dummyphoto="";this.panel=new Popup("checkin");this.panel.elem.find(".close").click(this.Close(this));this.panel.elem.find("#setpic").click(this.TakePhoto(this));this.panel.elem.find("#btnCheckin").click(this.DoCheckin(this));this.panel.elem.find(".button.toggle").click(DoToggle(this));this.panel.elem.find("#checkinComment").focus(this.DoCommentFocus(this)).blur(this.DoCommentFocus(this));this.postData={checkinLocation:"",checkinLat:"",checkinLng:"",checkinComment:"",checkinPhoto:"",
checkinAnonymous:"",checkinTwitter:"",checkinFacebook:"",checkinFoursquare:"",profileId:"",restaurantId:"",prizeId:"",decoy:"nothinghere"}}Checkin.prototype.TakePhoto=function(a){return function(){navigator.camera.getPicture(a.onSuccess,a.onFail,{quality:80,destinationType:destinationType.DATA_URL,correctOrientation:!0,encodingType:Camera.EncodingType.JPEG,targetWidth:1024,targetHeight:1024,saveToPhotoAlbum:!1})}};
Checkin.prototype.DoCommentFocus=function(a){return function(){a.panel.elem.find("#checkinComment").val()==lang.commentDefault?a.panel.elem.find("#checkinComment").val(""):""==a.panel.elem.find("#checkinComment").val()&&a.panel.elem.find("#checkinComment").val(lang.commentDefault)}};
Checkin.prototype.onSuccess=function(a){panel.checkin.postData.checkinPhoto=a;document.getElementById("myImage").src="data:image/jpeg;base64,"+panel.checkin.postData.checkinPhoto;a=new Image;a.src=$("#myImage").attr("src");a.width>a.height?($("#myImage").css("height",$("#setpic").height()+"px"),$("#myImage").css("margin-left",-((a.width*($("#setpic").height()/a.height)-$("#setpic").width())/2)+"px")):($("#myImage").css("margin-top",Math.floor(-((a.height*($("#setpic").width()/a.width)-$("#setpic").height())/
2))+"px"),$("#myImage").css("width",$("#setpic").width()+"px"))};
Checkin.prototype.DoCheckin=function(a){return function(){$("#btnCheckin").html("Sending...");"Comment"==a.panel.elem.find("#checkinComment").val()?a.postData.checkinComment="":a.postData.checkinComment=a.panel.elem.find("#checkinComment").val();a.panel.elem.find("#checkinAnonymous").hasClass("fa-check-square-o")?a.postData.checkinAnonymous=1:a.postData.checkinAnonymous=0;a.panel.elem.find("#checkinTwitter").hasClass("selected")?a.postData.checkinTwitter=1:a.postData.checkinTwitter=0;a.panel.elem.find("#checkinFacebook").hasClass("selected")?
a.postData.checkinFacebook=1:a.postData.checkinFacebook=0;a.panel.elem.find("#checkinFoursquare").hasClass("selected")?a.postData.checkinFoursquare=1:a.postData.checkinFoursquare=0;$.post(apipath+"/reactor/checkin/add/json",a.postData,a.HandleCheckinResponse(a))}};Checkin.prototype.HandleCheckinResponse=function(a){return function(b){DebugOut(JSON.stringify(b));DebugOut(b);$("#btnCheckin").html("Share");a.panel.Hide();panel.prize.LoadCheckinData();return!1}};
Checkin.prototype.onFail=function(a){alert("Failed because: "+a)};Checkin.prototype.Close=function(a){return function(){a.panel.Hide();return!1}};
Checkin.prototype.Load=function(a,b){$("#btnCheckin").html("Share");if(0<lsUserId){this.panel.elem.find("#myImage").attr("src","img/add_photo.png");if(null!=b){if(this.postData.checkinLocation=b.id,this.postData.checkinLat=b.location.lat,this.postData.checkinLng=b.location.lng,""!=b.location.lat&&""!=b.location.lng){var c="http://maps.googleapis.com/maps/api/staticmap?zoom=13&size="+Math.floor(0.3*this.panel.elem.width())+"x"+Math.floor(0.3*this.panel.elem.width())+"&maptype=roadmap&markers=color:red%7Clabel:C%7C"+
b.location.lat+","+b.location.lng+"&sensor=false";this.panel.elem.find(".locationmap").attr("src",c);this.panel.elem.find(".locationmap").show();this.panel.elem.find("#checkinAnonymous").show();this.panel.elem.find("#msgAnonymous").show()}}else this.panel.elem.find(".locationmap").hide(),this.panel.elem.find("#checkinAnonymous").hide(),this.panel.elem.find("#msgAnonymous").hide();this.postData.profileId=lsUserId;this.postData.prizeId=parseInt(panel.prize.prizeid);this.postData.restaurantId=parseInt(panel.prize.restaurantid);
this.panel.elem.find(".prizename").html(panel.prize.prizeName);this.panel.elem.find(".button.share").hide();$.get(apipath+"/reactor/srvlist/getprofile/"+lsUserId,this.HandleProfileData(this));$("#setpic").css("height",0.3*this.panel.elem.width()+"px").css("width",0.3*this.panel.elem.width()+"px");this.Show()}else panel.userlogin.Load()};Checkin.prototype.HandleProfileData=function(a){return function(a,c){for(idx in a.profile.auth)$("#checkin"+a.profile.auth[idx].authService).show()}};
Checkin.prototype.Show=function(){this.panel.Show();return!0};